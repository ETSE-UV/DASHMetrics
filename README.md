# DM-UV - DASH Metrics tool

TThis software is designed to analyze the traffic generated by videos that follow the MPEG-DASH protocol (for adaptative streaming videos). It works both for single processes and for multi-process programs. It can extract the initial requested MPD file ( that defines the characteristics of the MPEG-DASH video), and analyze overtime the performance of the stream: quality of the video, segments requested, codecs, response time, real bandwidth…
Besides analyzing MPEG-DASH traffic, it can calculate the total network usage and bandwidth of a process overtime 

## Download 
```
git clone https://github.com/ETSE-UV/DM-UV.git
```

## Requirements
*	This software has been designed to work in Windows Systems because it makes use of the Windows’ PowerShell for several purposes and its compatibility with different OS hasn’t been tested yet. 
*	For the proper functioning of the application, the tool TShark (the scripting tool of Wireshark) must be installed in the computer and a route to the installation folder must be provided.
*	As the software analyzes the MPEG-DASH video performance by analyzing network traffic, the connection must be unencrypted, otherwise the analysis won’t be possible.

## Before starting
*	The route to TShark can be provided during program execution, however it is recommended to change it in the text file on the program folder to save time.
*	If there doesn’t appear any interface to capture traffic it is a problem of Wireshark. To solve this issue on windows, it is necessary to open a console with administration rights and execute the order <<sc start npcap>> to start the necessary service.
*	The correct functioning of the program is based in the capture of the initial MPD request. When using a browser, between executions it is necessary to delete the cookies and browsing data of the online MPEG-DASH player because if the MPD file is already stored it won’t be downloaded again and the analysis won’t be possible.


## How to use

### Demo video

[![Watch the video](https://img.youtube.com/vi/sDITk7oNxLk/maxresdefault.jpg)](https://www.youtube.com/watch?v=sDITk7oNxLk)

### Total network usage and bandwidth for a single process
In this case we will only analyze the total network usage and bandwidth of a single process. We won’t be able to analyze mpeg-dash traffic.
1. We start with the confirmation of the TShark route (it is read from a text file on the program folder).
![Screenshot 1](https://raw.githubusercontent.com/ETSE-UV/DM-UV/master/Images/screenshot1.png)

2. We select the network interface where we want to capture traffic.
![Screenshot 2](https://raw.githubusercontent.com/ETSE-UV/DM-UV/master/Images/screenshot2.png)
In case no interface appears we execute with administrative rights the command <<sc start npcap>>
![Screenshot 3](https://raw.githubusercontent.com/ETSE-UV/DM-UV/master/Images/screenshot3.png)

3. We select the time duration of the capture.
![Screenshot 4](https://raw.githubusercontent.com/ETSE-UV/DM-UV/master/Images/screenshot4.png)

4. By default, we will use a single interval, but we can divide the capture in several time intervals.
![Screenshot 5](https://raw.githubusercontent.com/ETSE-UV/DM-UV/master/Images/screenshot5.png)

5. Select that we want to study a single process
![Screenshot 6](https://raw.githubusercontent.com/ETSE-UV/DM-UV/master/Images/screenshot6.png)

6. Select that we will only use a name process
![Screenshot 7](https://raw.githubusercontent.com/ETSE-UV/DM-UV/master/Images/screenshot7.png)
 
7. Confirmation of process name
![Screenshot 8](https://raw.githubusercontent.com/ETSE-UV/DM-UV/master/Images/screenshot8.png)
 
8. We start the process to study and make the preparations to play the video without loading it yet.
![Screenshot 9](https://raw.githubusercontent.com/ETSE-UV/DM-UV/master/Images/screenshot9.png)
![Screenshot 10](https://raw.githubusercontent.com/ETSE-UV/DM-UV/master/Images/screenshot10.png)
 
9. We start the capture and start playing the video
![Screenshot 11](https://raw.githubusercontent.com/ETSE-UV/DM-UV/master/Images/screenshot11.png)
![Screenshot 12](https://raw.githubusercontent.com/ETSE-UV/DM-UV/master/Images/screenshot12.png)

10. The program will detect the network connections of the process and will capture the generated traffic. However as it has to wait until the first connections are established, it misses the initial MPD request an it is not possible to analyze the MPEG-DASH traffic, but it is captured. The results will be saved in logs in the corresponding folder.
![Screenshot 13](https://raw.githubusercontent.com/ETSE-UV/DM-UV/master/Images/screenshot13.png)
![Screenshot 14](https://raw.githubusercontent.com/ETSE-UV/DM-UV/master/Images/screenshot14.png)
 
### Analysis of MPEG-DASH traffic for a single process
We follow the previous process up to step 5. On step 6 chose not to only use a name process.
7. Provide an URL for the MPEG-DASH video. The program will check if it is a valid URL. Finally we confirm the name of the process to study.
![Screenshot 15](https://raw.githubusercontent.com/ETSE-UV/DM-UV/master/Images/screenshot15.png)
![Screenshot 16](https://raw.githubusercontent.com/ETSE-UV/DM-UV/master/Images/screenshot16.png)

8. We start the capture and then we load and play the video (if we start the video before capturing we’ll miss the initial MPD request). When the capture ends the MPD request will be shown and the MPEG-DASH traffic analyzed. The results will be stored in logs.
![Screenshot 17](https://raw.githubusercontent.com/ETSE-UV/DM-UV/master/Images/screenshot17.png)
![Screenshot 18](https://raw.githubusercontent.com/ETSE-UV/DM-UV/master/Images/screenshot18.png)

### Analysis of MPEG-DASH traffic for a multi-process program (browser)
First we follow the previous steps up to the 5th. Then we select that we are NOT going to study a single process.
![Screenshot 19](https://raw.githubusercontent.com/ETSE-UV/DM-UV/master/Images/screenshot19.png)

6. We prepare the online MPEG-DASH player without loading the video yet. We should check that the connection is not encrypted.
![Screenshot 20](https://raw.githubusercontent.com/ETSE-UV/DM-UV/master/Images/screenshot20.png)

7. We start to capture and then we load and start the video.
![Screenshot 21](https://raw.githubusercontent.com/ETSE-UV/DM-UV/master/Images/screenshot21.png)
![Screenshot 22](https://raw.githubusercontent.com/ETSE-UV/DM-UV/master/Images/screenshot22.png)

8. When the  capture is done the results will be shown and stored in logs.
![Screenshot 23](https://raw.githubusercontent.com/ETSE-UV/DM-UV/master/Images/screenshot23.png)
![Screenshot 24](https://raw.githubusercontent.com/ETSE-UV/DM-UV/master/Images/screenshot24.png)
![Screenshot 25](https://raw.githubusercontent.com/ETSE-UV/DM-UV/master/Images/screenshot25.png)
 
## Other tools used during development
During the development of this tool we needed a single process capable of playing MPEG-DASH videos. After asking for permission, the tool we used was the plugin [NexPlayer™ for Unity](https://github.com/NexPlayer/NexPlayer_Unity_Plugin) 

[NexPlayer](https://www.nexplayersdk.com/)
